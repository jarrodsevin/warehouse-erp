generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Category {
  id        String    @id @default(cuid())
  name      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  products  Product[]
}

model Subcategory {
  id        String    @id @default(cuid())
  name      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  products  Product[]
}

model Brand {
  id        String    @id @default(cuid())
  name      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  products  Product[]
}

model Vendor {
  id             String          @id @default(cuid())
  name           String
  contactName    String?
  email          String?
  phone          String?
  terms          String?
  notes          String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  purchaseOrders PurchaseOrder[]
}

model Customer {
  id               String       @id @default(cuid())
  name             String
  email            String?
  phone            String?
  address          String?
  customerGroup    String
  customerCategory String
  creditLimit      Float        @default(0)
  currentBalance   Float        @default(0)
  paymentTerms     String?
  status           String       @default("active")
  notes            String?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  payments         Payment[]
  salesOrders      SalesOrder[]
  salesVisits      SalesVisit[]
}

model Product {
  id                 String              @id @default(cuid())
  sku                String              @unique
  name               String
  description        String?
  cost               Float
  retailPrice        Float
  floorPrice         Float?
  categoryId         String
  subcategoryId      String?
  brandId            String?
  unitOfMeasurement  String?
  packageSize        Float?
  casePackCount      Int?
  storageType        String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  inventory          Inventory?
  brand              Brand?              @relation(fields: [brandId], references: [id])
  category           Category            @relation(fields: [categoryId], references: [id])
  subcategory        Subcategory?        @relation(fields: [subcategoryId], references: [id])
  changeLogs         ProductChangeLog[]
  purchaseOrderItems PurchaseOrderItem[]
  salesOrderItems    SalesOrderItem[]
}

model ProductChangeLog {
  id             String   @id @default(cuid())
  productId      String
  changeType     String
  oldCost        Float?
  newCost        Float?
  oldRetail      Float?
  newRetail      Float?
  oldMargin      Float?
  newMargin      Float?
  oldDescription String?
  newDescription String?
  changedAt      DateTime @default(now())
  product        Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([changedAt])
}

model Inventory {
  id              String    @id @default(cuid())
  productId       String    @unique
  quantityOnHand  Int       @default(0)
  reorderLevel    Int       @default(0)
  reorderQuantity Int       @default(0)
  currentCost     Float     @default(0)
  lastCostUpdate  DateTime?
  lastRestocked   DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  product         Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
}

model PurchaseOrder {
  id           String              @id @default(cuid())
  poNumber     String              @unique
  vendorId     String
  orderDate    DateTime            @default(now())
  expectedDate DateTime?
  receivedDate DateTime?
  status       String              @default("pending")
  notes        String?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  vendor       Vendor              @relation(fields: [vendorId], references: [id])
  items        PurchaseOrderItem[]
}

model PurchaseOrderItem {
  id              String        @id @default(cuid())
  purchaseOrderId String
  productId       String
  quantity        Int
  unitCost        Float
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  product         Product       @relation(fields: [productId], references: [id])
  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
}

model SalesOrder {
  id            String           @id @default(cuid())
  soNumber      String           @unique
  customerId    String
  orderDate     DateTime         @default(now())
  status        String           @default("fulfilled")
  subtotal      Float
  total         Float
  notes         String?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  acceptedAt    DateTime?
  orderAccepted Boolean          @default(false)
  printedName   String?
  signature     String?
  customer      Customer         @relation(fields: [customerId], references: [id])
  items         SalesOrderItem[]
}

model SalesOrderItem {
  id           String     @id @default(cuid())
  salesOrderId String
  productId    String
  quantity     Int
  unitPrice    Float
  lineTotal    Float
  createdAt    DateTime   @default(now())
  product      Product    @relation(fields: [productId], references: [id])
  salesOrder   SalesOrder @relation(fields: [salesOrderId], references: [id], onDelete: Cascade)
}

model Payment {
  id              String   @id @default(cuid())
  customerId      String
  amount          Float
  paymentDate     DateTime @default(now())
  paymentMethod   String?
  referenceNumber String?
  notes           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  customer        Customer @relation(fields: [customerId], references: [id])
}

model SalesVisit {
  id         String   @id @default(cuid())
  customerId String
  visitDate  DateTime @default(now())
  notes      String?
  images     String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  customer   Customer @relation(fields: [customerId], references: [id])

  @@index([customerId])
  @@index([visitDate])
}
